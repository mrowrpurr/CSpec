set(current_working_directory "${CMAKE_SOURCE_DIR}")

function(include_assertion assertion)
    set(assertion_path "${CSpecAssertionsIncludeDir}/${assertion}")
    if(NOT assertion_path MATCHES .cmake$)
        string(APPEND assertion_path ".cmake")
    endif()
    if(EXISTS "${assertion_path}")
        include("${assertion_path}")
    else()
        message(FATAL_ERROR "Assertion not found: ${assertion} (${assertion_path})")
    endif()
endfunction()

function(get_temp_path out_path_var)
    string(RANDOM random)
    string(TIMESTAMP timestamp "%m-%d-%Y_%H-%M-%S_%f")
    set(${out_path_var} "${CSPEC_TEMP_FOLDER}/${CSPEC_FILE_ID}/${CSPEC_TEST_FUNCTION}/${timestamp}-${random}" PARENT_SCOPE)
endfunction()

function(get_temp_directory out_path_var)
    get_temp_path(path)
    if(NOT IS_DIRECTORY "${path}")
        file(MAKE_DIRECTORY "${path}")
    endif()
    set(${out_path_var} "${path}" PARENT_SCOPE)
endfunction()

function(get_temp_file out_path_var)
    get_temp_path(path)
    if(NOT EXISTS "${path}")
        file(TOUCH "${path}")
    endif()
    set(${out_path_var} "${path}" PARENT_SCOPE)
endfunction()

function(get_relative_path out path)
    if(path MATCHES "^\\./" OR path MATCHES "^\\.\\\\")
        file(REAL_PATH "${path}" real BASE_DIRECTORY "${current_working_directory}")
        string(REGEX REPLACE "\\\\" "/" path "${path}")
        set(${out} "${real}" PARENT_SCOPE)
    else()
        string(REGEX REPLACE "\\\\" "/" path "${path}")
        set("${out}" "${path}" PARENT_SCOPE)
    endif()
endfunction()

function(cd path)
    get_relative_path(path "${path}")
    get_filename_component(dir "${path}" DIRECTORY)
    FILE(MAKE_DIRECTORY "${dir}")
    set(current_working_directory "${path}")
endfunction()

function(touch path)
    get_relative_path(path "${path}")
    get_filename_component(dir "${path}" DIRECTORY)
    FILE(MAKE_DIRECTORY "${dir}")
    file(TOUCH "${path}")
endfunction()

function(file_write path content)
    get_relative_path(path "${path}")
    get_filename_component(dir "${path}" DIRECTORY)
    FILE(MAKE_DIRECTORY "${dir}")
    file(WRITE "${path}" "${content}")
endfunction()

function(rm path)
    get_relative_path(path "${path}")
    file(REMOVE_RECURSE "${path}")
endfunction()

function(cat path)
    get_relative_path(path "${path}")
    file(READ "${path}" content)
    message(STATUS "${content}")
endfunction()

function(clean_build_folder)
    rm("${CMAKE_SOURCE_DIR}/build")
endfunction()
